
# Power BI DAX


## 度量值
- 度量值用于一些最常见的数据分析。例如，求和、平均值、最小值或最大值、计数，或自己使用 DAX 公式创建的更高级的计算。度量值的计算结果也始终随着你与的报表的交互而改变，以便进行快速和动态的临时数据浏览。
- 通常自动为用户创建度量值，系统会自动提供一种计算，显示在“字段”框中且带有一个 sigma 图标 ∑的任何字段为数值，并且其值可以聚合。当 Power BI Desktop 检测到数字类型数据列时，它不会直接显示包含 200 万行 SalesAmount 值的表，而是自动创建度量值来计算聚合数据。 求和是数字类型数据的默认聚合方式，但可以轻松应用不同类型的聚合方式，如**平均值或计数**。
- 要将图表聚合更改为平均值，在“可视化效果”窗格“值”区域中，单击SalesAmount旁边的向下箭头，并选择“平均值”。
- 创建度量值，使用到DAX
```
Projected Sales = SUM('Sales'[Last Years Sales])*1.06
```
- 在另一个度量值中使用度量值
    - 已经创建的度量值可以直接使用 不需要再使用聚合函数
```
Net Sales per Unit = [Net Sales] / SUM(Sales[SalesQuantity])
```
    
## 新建列
- 计算列类似于度量值，因为二者都基于DAX公式，但它们的区别在于使用方式。通常会在可视化效果的“值”区域中使用度量值，以基于其他字段计算结果。可以将计算列用作可视化效果的行、轴、图例和组区域中的新字段。
- 当前分析的数据不包含获取期望结果所需的特定字段。这就是计算列的有用之处。计算列使用数据分析表达式(DAX)公式来定义列值，包括从组合几个不同列中的文本值到通过其他值计算数值的任何操作。 例如，假设你的数据中含有“城市”和“州”两个字段，但你想要使用单一“位置”字段来同时含这两项内容，如“迈阿密，佛罗里达州”。 这正符合计算列的用途。
- 凭借计算列，你可以将新数据添加到模型中已存在的表。在Power BI Desktop中，使用“报表”视图中的“新建列”功能创建计算列。
- 与使用查询编辑器中的“添加自定义列”创建为查询的一部分的自定义列不同，在报表视图或数据视图中创建的计算列以你已加载到模型中的数据为基础。例如，可以选择连接两个不同但相关的表中的值、执行添加或提取子字符串。

# DAX
- DAX 是公式或表达式中可用于计算并返回一个或多个值的函数、运算符或常量的集合。简单来说，DAX 可帮助你通过模型中已有的数据来创建新信息。

## 语法
```
Total Sales = SUM(Sales[SalesAmount])
```
- 此度量值会将所包括的其他每个字段的销售额相加，进行计算并返回值。
- 这个度量值的功能与直接将 SalesAmount 字段添加到我的报表中一样,创建自己的度量值来对 SalesAmount 字段中的值求和有个好处：我们可以将它当作参数用于其他公式

## 函数
- 日期和时间函数
- 筛选器函数
- 信息函数
- 逻辑函数
- 数学和三角函数
- 统计函数
- 文本函数

## 上下文
- 上下文是需要了解的重要 DAX 概念之一。 DAX 中有两种上下文类型；行上下文和筛选上下文。 

- “行上下文”可被视为“当前行”。如果创建了计算列，则行上下文由每个单独行中的值以及与当前行相关的列中的值组成。 还有一些函数（EARLIER和EARLIEST）可从当前行获取值，然后在对整个表执行操作时使用该值。

- “筛选上下文”是根据筛选约束（已应用于行或由公式中的筛选表达式定义）而允许在每列中存在的值集。可以将筛选器上下文视为：决定结果或值的计算中**所应用的一个或多个筛选器。**
- 筛选器:FILTER,ALL,ALLEXCEPT等